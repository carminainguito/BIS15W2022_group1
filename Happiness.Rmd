---
title: "Happiness"
author: "Shuyi Bian, Carmina Inguito, Yutong Ji"
date: "`2022-03-03`"
output:
  html_document: 
    theme: spacelab
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Introduction 

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(ggmap)
library(tidyverse)
library(RColorBrewer)
library(paletteer)
library(janitor)
library(here)
library(ggthemes)
library(ggVennDiagram)
```

```{r}
options(scipen=999)
```


## Laod and Clean the Data
```{r}
happiness_2015 <- readr::read_csv("data/2015.csv")%>% 
  clean_names()
happiness_2016 <- readr::read_csv("data/2016.csv")%>% 
  clean_names()
happiness_2017 <- readr::read_csv("data/2017.csv")%>% 
  clean_names()
happiness_2018 <- readr::read_csv("data/2018.csv")%>% 
  clean_names()
happiness_2019 <- readr::read_csv("data/2019.csv")%>% 
  clean_names()
```
## Merging Data Frames
**Add year**
```{r}
# Add year
happiness_2015_join <- happiness_2015 %>% 
  mutate(year = case_when(country != "NA" ~ "2015"))
happiness_2016_join <- happiness_2016 %>% 
  mutate(year = case_when(country != "NA" ~ "2016"))
happiness_2017_join <- happiness_2017 %>% 
  mutate(year = case_when(country != "NA" ~ "2017"))
happiness_2018_join <- happiness_2018 %>% 
  mutate(year = case_when(country_or_region != "NA" ~ "2018"))
happiness_2019_join <- happiness_2019 %>% 
  mutate(year = case_when(country_or_region != "NA" ~ "2019"))
```

**Change column names**
```{r}
#Change Column names
happiness_2015_join <- happiness_2015_join %>% 
  rename(country_or_region = country)

happiness_2016_join <- happiness_2016_join %>% 
  rename(country_or_region = country)

happiness_2017_join <- happiness_2017_join %>% 
  rename(country_or_region = country)

happiness_2018_join <- happiness_2018_join %>% 
  rename(happiness_rank = overall_rank,
         happiness_score = score,
         economy_gdp_per_capita = gdp_per_capita,
         family = social_support,
         health_life_expectancy = healthy_life_expectancy,
         freedom = freedom_to_make_life_choices,
         trust_government_corruption = perceptions_of_corruption)

happiness_2019_join <- happiness_2019_join %>% 
  rename(happiness_rank = overall_rank,
         happiness_score = score,
         economy_gdp_per_capita = gdp_per_capita,
         family = social_support,
         health_life_expectancy = healthy_life_expectancy,
         freedom = freedom_to_make_life_choices,
         trust_government_corruption = perceptions_of_corruption)
```

**Merge data frames together**
```{r}
#merge data frames together
#thank you Joel
happiness_2018_join$trust_government_corruption <- as.numeric(happiness_2018_join$trust_government_corruption)

complete_happiness <- bind_rows(happiness_2015_join, happiness_2016_join, happiness_2017_join, happiness_2018_join, happiness_2019_join) #bind the data frames

complete_happiness <- complete_happiness %>% 
  select(-region, -standard_error, -dystopia_residual, -lower_confidence_interval, -upper_confidence_interval, -whisker_high, -whisker_low) #remove unwanted columns
```
```{r}
complete_happiness_ave <- complete_happiness %>%
  select(-happiness_rank)%>%
  group_by(country_or_region)%>%
  mutate(mean_happiness_score = mean(happiness_score), 
         mean_gdp_contrib = mean(economy_gdp_per_capita), 
         mean_family_contrib = mean(family), 
         mean_health_contrib = mean(health_life_expectancy), 
         mean_freedom_contrib = mean(freedom), 
         mean_trust_contrib = mean(trust_government_corruption), 
         mean_generosity_contrib = mean(generosity))

```

## Exploring the Data 
**Here, we're interested in understanding what kind of data we're going to be working with by utilizing several functions to observer its structure.**
```{r}
summary(complete_happiness)
```

```{r}
glimpse(complete_happiness)
```

```{r}
complete_happiness %>%
  naniar::miss_var_summary()
```

##Venn Diagram
```{r}
happiness_venn <- complete_happiness_ave %>% 
  mutate(economy_contribution_percentage = mean_gdp_contrib/mean_happiness_score,
         family_contribution_percentage = mean_family_contrib/mean_happiness_score, 
         health_contribution_percentage = mean_health_contrib/mean_happiness_score, 
         freedom_contribution_percentage = mean_freedom_contrib/mean_happiness_score, 
         generosity_contribution_percentage = mean_generosity_contrib/mean_happiness_score, 
         happiness_category = case_when(mean_happiness_score <= 3 ~ "very unhappy",
                                                   mean_happiness_score > 3 & mean_happiness_score <= 5 ~ "unhappy",
                                                   mean_happiness_score > 5 & mean_happiness_score <= 7 ~ "happy",
                                                   mean_happiness_score > 7 ~ "very happy"), 
         economy_category = case_when(economy_contribution_percentage < 0.0833 ~ "insignificant",
                                      economy_contribution_percentage >= 0.0833 ~ "significant"), 
         family_category = case_when(family_contribution_percentage < 0.0833 ~ "insignificant",
                                      family_contribution_percentage >= 0.0833 ~ "significant"),
         health_category = case_when(health_contribution_percentage < 0.0833 ~ "insignificant",
                                      health_contribution_percentage >= 0.0833 ~ "significant"),
         freedom_category = case_when(freedom_contribution_percentage < 0.0833 ~ "insignificant", 
                                      freedom_contribution_percentage >= 0.0833 ~ "significant"), 
         generosity_category = case_when(generosity_contribution_percentage < 0.0833 ~ "insignificant",
                                      generosity_contribution_percentage >= 0.0833 ~ "significant"))
```

```{r}
happy_country_vec <- happiness_venn %>%
  filter(happiness_category == "happy" | happiness_category == "very happy")%>%
  pull(country_or_region)
gdp_vec <- happiness_venn %>%
  filter(economy_category == "significant")%>%
  pull(country_or_region)
generosity_vec <- happiness_venn %>%
  filter(generosity_category == "significant")%>%
  pull(country_or_region)
family_vec <- happiness_venn %>%
  filter(family_category == "significant")%>%
  pull(country_or_region)
health_vec <- happiness_venn %>%
  filter(health_category == "significant")%>%
  pull(country_or_region)
freedom_vec <- happiness_venn %>%
  filter(freedom_category == "significant")%>%
  pull(country_or_region)
```

```{r}
why_happy_list <- list(happy_country_vec, gdp_vec, generosity_vec)
ggVennDiagram(why_happy_list, 
              category.names = c("Happy Country", "GDP", "Generosity"), 
              label_color = "black")+
  ggplot2::scale_fill_gradient(low="navyblue",high = "yellow")
```
